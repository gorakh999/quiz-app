<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Quiz</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <script type="text/javascript">
        let timeLeft = [[${seconds}]];
        let totalTime = timeLeft;
        let timer;

        function startTimer() {
            timer = setInterval(function () {
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    setTimeTaken();
                    document.getElementById("quizForm").submit();
                } else {
                    document.getElementById("timer").innerText = timeLeft + "s remaining";
                }
                timeLeft -= 1;
            }, 1000);
        }

        function setTimeTaken() {
            const timeTaken = totalTime - timeLeft;
            document.getElementById("timeTakenInput").value = timeTaken;
        }

        window.onload = function() {
            startTimer();
            document.getElementById("quizForm").addEventListener("submit", function(e) {
                setTimeTaken();
            });
        };
    </script>
</head>
<body>
<h2>Quiz</h2>
<div id="timer"></div>

<form id="quizForm" th:action="@{/submit}" th:object="${quizForm}" method="post">
    <input type="hidden" th:field="*{username}"/>
    <input type="hidden" th:field="*{timeTaken}" id="timeTakenInput" value="0"/>

    <div th:each="question, iterStat : ${questions}">
        <p><b th:text="${iterStat.index + 1} + '. ' + ${question.text}"></b></p>
        <input type="hidden" th:field="*{answers[__${iterStat.index}__].questionId}"
               th:value="${question.id}"/>
        <div th:each="option, optIdx : ${question.options}">
            <label>
                <input type="radio"
                       th:field="*{answers[__${iterStat.index}__].answer}"
                       th:value="${option}"/>
                <span th:text="${option}"></span>
            </label><br/>
        </div>
        <br/>
    </div>
    <button type="submit">Submit</button>
</form>
</body>
</html>
